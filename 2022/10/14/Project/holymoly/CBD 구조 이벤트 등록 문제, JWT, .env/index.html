
<!DOCTYPE html>
<html lang="ko">
    <link rel="canonical" href="https://loco9939.github.io/2022/10/14/project/holymoly/cbd 구조 이벤트 등록 문제, jwt, .env/"/>

<head>
    <meta name="google-site-verification" content="7ur7A9bi79NuylPOO6FjMynEeinWe-v-kmDPZD-bcqY" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Loco&#39;s Dev Blog">
    <title>CBD 구조 이벤트 등록 문제, JWT, .env - Loco&#39;s Dev Blog</title>
    <meta name="author" content="loco9939">
    
        <meta name="keywords" content="loco9939,javascript,">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"loco9939","sameAs":["https://github.com/loco9939","mailto"]},"articleBody":"1. CBD 구조의 이벤트 등록 문제현재 CBD의 구조 상 이벤트를 component를 호출할 때마다 이벤트 목록을 확인하여 이미 등록된 이벤트는 중복 등록되지 않도록 하고 있다.\n그래서 효율적이라고 생각했다. 하지만 하위 컴포넌트에서 이벤트를 등록해주고 이벤트 핸들러 안에서 this.prop로 상태를 참조할 때, 이벤트가 등록될 시점을 참조하고 있어서 setState로 전역 상태를 변경시켜줘도 변경된 state를 이벤트 핸들러 내부에서 참조할 수 없는 문제점이 발생하였다.\n이러한 문제점을 해결하기 위해 구조를 바꿔보려는 시도를 하였지만, 프로젝트 시간 상 이는 감당하기 어려워 포기하였다.\n컴포넌트 호출 시마다 이벤트 제거와 새로 등록위 문제를 해결하기 위한 방법으로 컴포넌트를 호출할 때마다 등록된 이벤트를 제거하고 새로 이벤트를 등록하는 방법이 있다.\n하지만 이벤트 핸들러를 **익명함수(() &#x3D;&gt; {})**를 통해 등록해주고 있었기 때문에 이를 전부 기명함수로 변경해줘야지만 removeEventListener() 메서드를 사용하여 등록된 이벤트를 제거할 수 있었다.\n하지만, 기명함수로 바꿔서 addEventListener() 메서드로 등록을 해줘도 제대로 동작하지 않았고 이부분에서 많은 시간을 할애하였다. 지금 내가 해결하려는 문제가 작은 부분에 몰두해있는 것 같고 시간이 부족하여 방법을 바꾸기로 하였다.\n그래서 현 구조에서 하위 컴포넌트의 상태를 관리해주기 위해 App 컴포넌트에 상태를 등록하여 전역 상태로 관리해주기로 결정하였다.\n전역 상태로 하위 컴포넌트 상태 관리123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687let openCard = [];let matchedCard = [];let isStarted = false;let convertedTime = 0;class MatchingCards extends Component &#123;  addEvent() &#123;    return [      this.createEvent(&#123;        type: &quot;click&quot;,        selector: &quot;.start-button&quot;,        handler: () =&gt; &#123;          this.props.start();        &#125;,      &#125;),      this.createEvent(&#123;        type: &quot;click&quot;,        selector: &quot;.card-front&quot;,        handler: (e) =&gt; &#123;          if (openCard.length === 2 || !isStarted) return;          this.props.checkCard(+e.target.closest(&quot;.cards&quot;).dataset.id);          if (openCard.length === 2) &#123;            if (              this.props.shuffledNum[openCard[0] - 1] ===              this.props.shuffledNum[openCard[1] - 1]            ) &#123;              console.log(&quot;HOLYMOLY&quot;);              this.props.matchCard(openCard);              matchedCard = [...matchedCard, ...openCard];            &#125;            setTimeout(() =&gt; &#123;              this.props.resetOpenedCard();            &#125;, 500);          &#125;        &#125;,      &#125;),      this.createEvent(&#123;        type: &quot;click&quot;,        selector: &quot;.reset-button&quot;,        handler: () =&gt; &#123;          openCard = [];          matchedCard = [];          this.props.resetGame();        &#125;,      &#125;),    ];  &#125;  domStr() &#123;    openCard = this.props.openCard;    isStarted = this.props.isStarted;    convertedTime = this.props.convertedTime;    return `    &lt;div class=&quot;container&quot;&gt;      &lt;h1 class=&quot;game-title&quot;&gt;MATCHING CARDS&lt;/h1&gt;      &lt;div class=&quot;card-container&quot;&gt;        $&#123;this.props.shuffledNum          .map(            (num, index) =&gt; `          &lt;div class=&quot;cards $&#123;            openCard.includes(index + 1) || matchedCard.includes(index + 1)              ? &quot;opened&quot;              : &quot;&quot;          &#125;&quot; data-id=&quot;$&#123;index + 1&#125;&quot;&gt;            &lt;div class=&quot;card-inner&quot;&gt;              &lt;div class=&quot;card-front&quot;&gt;?&lt;/div&gt;              &lt;div class=&quot;card-back&quot;&gt;$&#123;num&#125;&lt;/div&gt;            &lt;/div&gt;          &lt;/div&gt;          `          )          .join(&quot;&quot;)&#125;      &lt;/div&gt;      &lt;p class=&quot;result-message $&#123;        matchedCard.length === 18 ? &quot;&quot; : &quot;hidden&quot;      &#125;&quot;&gt;Congratulations!&lt;/p&gt;      &lt;p class=&quot;display&quot;&gt;$&#123;convertedTime&#125;&lt;/p&gt;      &lt;div class=&quot;active-button-container&quot;&gt;        &lt;button class=&quot;start-button&quot;&gt;Start&lt;/button&gt;        &lt;button class=&quot;reset-button&quot;&gt;RESET&lt;/button&gt;      &lt;/div&gt;    &lt;/div&gt;    `;  &#125;&#125;\n\n\n전역 상태를 domStr()을 호출할 때 지역 변수에 할당하여 지역 변수를 가지고 이벤트 핸들러 내부에서 로직을 구현하였다.\n\n이로 인한 문제점이 게임의 진행을 위해서는 렌더링을 해주기 위해서는 전역 상태를 setState로 변경해줘야 하고 지역 변수를 변경도 이벤트 핸들러 내부에서 따로 해줘야 하므로 같은 로직을 구현하는 상태를 2번 관리해줘야 하는 불편함이 생겼다.\n\n이는 다음주에 리팩토링이 필요할 것으로 보인다.\n\n\n2. 로그인 기능 및 서버 구현클라이언트 사이드먼저 클라이언트는 로그인 페이지에서 input 값으로 요청을 보낸다. 이 때, 서버에 대한 요청을 e.preventDefault()로 막아주고 payload에다가 input 값을 담아서 axios로 post 요청을 보내주었다.(서버의 응답이 도착할 때 까지 await해주었다.)\n12345678910111213141516171819202122232425262728293031// Signin.jsthis.createEvent(&#123;  type: &#x27;submit&#x27;,  selector: &#x27;.signin_info&#x27;,  handler: async e =&gt; &#123;    e.preventDefault();    const payload = [...new FormData(document.querySelector(&#x27;.signin_info&#x27;))].reduce(      (obj, [key, value]) =&gt; ((obj[key] = value), obj),      &#123;&#125;    );    try &#123;      const &#123; data: user &#125; = await axios.post(&#x27;/signin&#x27;, payload);      console.log(&#x27;😀 LOGIN SUCCESS!&#x27;);      if (user) this.props.navigate(&#x27;/&#x27;, user);      localStorage.setItem(&#x27;user&#x27;, JSON.stringify(user));    &#125; catch (e) &#123;      console.log(&#x27;😱 LOGIN FAILURE..&#x27;);      document.querySelector(&#x27;.error&#x27;).classList.remove(&#x27;hidden&#x27;);    &#125;  &#125;,&#125;),  // App.jsnavigate(path, user = null) &#123;  if (window.location.pathname === path) return;  window.history.pushState(null, null, path);  if (user) this.setState(&#123; path, user &#125;);  else this.setState(&#123; path &#125;);&#125;\n\n서버에서 응답이 오면 navigate 함수에 메인페이지의 path와 응답으로 받은 데이터를 인자로 넘겨주었다. navigate 함수에서는 user가 있으면 user 상태를 변경하여 렌더링을 해주고 user가 없으면 path에 따라서만 라우터 변경과 렌더링을 해준다.\n서버 사이드서버에서는 해당 url로 post 요청이 왔을 때, 서버의 데이터에 해당 유저의 id, password를 비교하여 존재하는 유저인지 확인하여 JWT 토큰을 발행하여 쿠키에 담고 이 쿠키와 함께 유저의 닉네임을 응답으로 전달해주었다.\n123456789101112131415161718192021222324252627282930// server.jsapp.post(&quot;/signin&quot;, (req, res) =&gt; &#123;  const &#123; userid, password &#125; = req.body;  // userid 가 없거나, password가 없으면 띄워주는 에러메세지  if (!userid || !password)    return res      .status(401)      .send(&#123; error: &quot;사용자 아이디 또는 패스워드가 전달되지 않았습니다.&quot; &#125;);  // users배열에 userid와 password가 일치하는 user있는지 find 해서 user에 담아준다.  const user = users.find(    (user) =&gt; user.userid === userid &amp;&amp; user.password === password  );  // 만약 위 검색에서 user가 담기지 않았다면 띄워주는 에러메세지  if (!user)    return res.status(401).send(&#123; error: &quot;등록되지 않은 사용자입니다.&quot; &#125;);  // 로그인 성공 시 user 가 있다면 jwt 토큰을 발급해서 response의 헤더에 쿠키에 담아서 보내줘야함.  const accessToken = jwt.sign(&#123; userid &#125;, process.env.JWT_SECRET_KEY, &#123;    expiresIn: &quot;1d&quot;,  &#125;);  res.cookie(&quot;accessToken&quot;, accessToken, &#123;    maxAge: 1000 * 60 * 60 * 24 * 7, // 7d    httpOnly: true,  &#125;);  res.send(user.nickname);&#125;);\n\nJWT(JSON Web Token)이란?Access token을 이용한 서버 인증 방식 중 하나이다.\n서버에 로그인 요청이 오면 사용자를 확인한 다음 JWT을 발행한다. 생성한 토큰을 클라이언트에게 쿠키를 통해 전달해주고 클라이언트는 쿠키에 이 토큰을 저장한다.\n\n토큰은 암호화되어있고 클라이언트에서는 암호화를 해석한 코드를 가지게 하면 안되며 암호를 해석하는 일은 서버에서만 해야한다.\n\n이제 토큰이 있는 사용자는 권한이 필요한 요청을 할 때마다 토큰을 header에 실어 서버에 보낸다.\n서버는 토큰을 해석하여 로그인한 사용자인지를 판단하여 성공 및 실패 응답을 보내준다.\n.env 이란?.env 파일에는 개발을 하면서 중요한 정보들 특히, DB 관련 정보와 API_KEY 등의 정보를 보관하는 용도의 파일이다.\n이러한 파일들은 git에 올리면 안되므로 gitignore를 해줘야한다.\n\n사용방법\n\n123npm install dotenv  //다운로드require(&quot;dotenv&quot;).config(); //js 파일 상단에 적어주기\n\n\n.env 파일은 최상위 루트에 생성해야한다.\n\n12345// .envPORT = 5010;// server.jsconst port = process.env.PORT;\n\n\n이러한 방식으로 사용한다.\n\n3. 로그인한 유저에게 인가로그인한 유저는 JWT를 쿠키에 가지고 있으므로 권한이 필요한 요청을 할 때, 즉 로그인한 사용자만 접근 가능한 페이지에 접근 요청을 서버에 보내면 서버는 JWT를 해석하여 로그인한 사용자인지 아닌지를 판단하여 그에 알맞은 응답을 보낸다.\n그에 대한 로직은 다음과 같다.\n12345678910111213141516171819const auth = (req, res, next) =&gt; &#123;    /**     * 토큰이 리퀘스트의 Authorization 헤더를 통해 전달되면 req.headers.authorization으로 전달받고     * 토큰이 쿠키를 통해 전달되면 req.cookies.accessToken으로 전달받는다.     */    const accessToken = req.headers.authorization || req.cookies.accessToken;    try &#123;      const decoded = jwt.verify(accessToken, process.env.JWT_SECRET_KEY);      console.log(`😀 사용자 인증 성공`, decoded);      next();    &#125; catch (e) &#123;      console.error(&#x27;😱 사용자 인증 실패..&#x27;, e);      res.status(401).send(&#123; error: &#x27;등록되지 않은 사용자입니다.&#x27; &#125;);    &#125;    app.get(&#x27;/rank&#x27;, auth, (req, res) =&gt; &#123;    res.send(&#x27;로그인된 사용자입니다.&#x27;);  &#125;);\n\n\n&#x2F;rank url로 요청이 오면 auth 함수를 실행한다.\n\nauth 함수에서는 요청의 header나 쿠키에 권한이나 access token이 있는지를 확인하여 이를 해석하고 로그인 성공 실패 유무를 판단하여 응답을 보내준다.\n\n\n소감프로젝트를 시작하기 전에 기술적인 기획이 매우 중요하다는 것을 깨닫게 되었다. 하위 컴포넌트에서 지역 상태를 관리할 수 없을 것이라는 것을 구조를 보고 알 수 있었더라면, 그에 따라 구조를 개선한 후 프로젝트에 임할 수 있었을 텐데 중간에 큰 문제에 봉착하게 되니 머리가 텅 비워지는 상황을 경험하였다. 결국 시간을 고려하여 회피를 하게되는 문제점이 발생하게 되었다.\n팀원 중 한명이 몸이 안좋아 2명이서 프로젝트를 진행하게 되었다. 3명이서 같이 나눠서 공부하고 공유하면 더욱 좋았을텐데 이점은 조금 아쉽다. 건강상의 이유로 참여하지 못한 팀원도 안쓰러웠다. 다음주에 쾌유해서 돌아오면 그동안 공부했던 것을 공유해주면서 배웠던 지식을 다시 정리해봐야겠다.\n","dateCreated":"2022-10-14T22:10:39+09:00","dateModified":"2022-10-29T18:54:25+09:00","datePublished":"2022-10-14T22:10:39+09:00","description":"","headline":"CBD 구조 이벤트 등록 문제, JWT, .env","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"},"publisher":{"@type":"Organization","name":"loco9939","sameAs":["https://github.com/loco9939","mailto"]},"url":"https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/","keywords":"JWT, env"}</script>
    <meta name="description" content="1. CBD 구조의 이벤트 등록 문제현재 CBD의 구조 상 이벤트를 component를 호출할 때마다 이벤트 목록을 확인하여 이미 등록된 이벤트는 중복 등록되지 않도록 하고 있다. 그래서 효율적이라고 생각했다. 하지만 하위 컴포넌트에서 이벤트를 등록해주고 이벤트 핸들러 안에서 this.prop로 상태를 참조할 때, 이벤트가 등록될 시점을 참조하고 있어서 s">
<meta property="og:type" content="blog">
<meta property="og:title" content="CBD 구조 이벤트 등록 문제, JWT, .env">
<meta property="og:url" content="https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/index.html">
<meta property="og:site_name" content="Loco&#39;s Dev Blog">
<meta property="og:description" content="1. CBD 구조의 이벤트 등록 문제현재 CBD의 구조 상 이벤트를 component를 호출할 때마다 이벤트 목록을 확인하여 이미 등록된 이벤트는 중복 등록되지 않도록 하고 있다. 그래서 효율적이라고 생각했다. 하지만 하위 컴포넌트에서 이벤트를 등록해주고 이벤트 핸들러 안에서 this.prop로 상태를 참조할 때, 이벤트가 등록될 시점을 참조하고 있어서 s">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2022-10-14T13:10:39.000Z">
<meta property="article:modified_time" content="2022-10-29T09:54:25.506Z">
<meta property="article:author" content="loco9939">
<meta property="article:tag" content="JWT">
<meta property="article:tag" content="env">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-alaac2o0p8lb5n7mx8aazw1dzhwcsltexgjtf9twurzytkujqiefoq1soijy.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Loco&#39;s Dev Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/loco9939"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            CBD 구조 이벤트 등록 문제, JWT, .env
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-10-14T22:10:39+09:00">
	
		    2022/10/14
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/categories/Project/">Project</a>, <a class="category-link" href="/categories/Project/holymoly/">holymoly</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="1-CBD-구조의-이벤트-등록-문제"><a href="#1-CBD-구조의-이벤트-등록-문제" class="headerlink" title="1. CBD 구조의 이벤트 등록 문제"></a>1. CBD 구조의 이벤트 등록 문제</h1><p>현재 CBD의 구조 상 이벤트를 component를 호출할 때마다 이벤트 목록을 확인하여 이미 등록된 이벤트는 중복 등록되지 않도록 하고 있다.</p>
<p>그래서 효율적이라고 생각했다. 하지만 하위 컴포넌트에서 이벤트를 등록해주고 이벤트 핸들러 안에서 this.prop로 상태를 참조할 때, 이벤트가 등록될 시점을 참조하고 있어서 setState로 전역 상태를 변경시켜줘도 <strong>변경된 state를 이벤트 핸들러 내부에서 참조할 수 없는 문제점이 발생하였다.</strong></p>
<p>이러한 문제점을 해결하기 위해 구조를 바꿔보려는 시도를 하였지만, 프로젝트 시간 상 이는 감당하기 어려워 포기하였다.</p>
<h2 id="컴포넌트-호출-시마다-이벤트-제거와-새로-등록"><a href="#컴포넌트-호출-시마다-이벤트-제거와-새로-등록" class="headerlink" title="컴포넌트 호출 시마다 이벤트 제거와 새로 등록"></a>컴포넌트 호출 시마다 이벤트 제거와 새로 등록</h2><p>위 문제를 해결하기 위한 방법으로 컴포넌트를 호출할 때마다 등록된 이벤트를 제거하고 새로 이벤트를 등록하는 방법이 있다.</p>
<p>하지만 이벤트 핸들러를 **익명함수(() &#x3D;&gt; {})**를 통해 등록해주고 있었기 때문에 이를 전부 기명함수로 변경해줘야지만 <code>removeEventListener()</code> 메서드를 사용하여 등록된 이벤트를 제거할 수 있었다.</p>
<p>하지만, 기명함수로 바꿔서 <code>addEventListener()</code> 메서드로 등록을 해줘도 제대로 동작하지 않았고 이부분에서 많은 시간을 할애하였다. 지금 내가 해결하려는 문제가 작은 부분에 몰두해있는 것 같고 시간이 부족하여 방법을 바꾸기로 하였다.</p>
<p>그래서 현 구조에서 하위 컴포넌트의 상태를 관리해주기 위해 <strong>App 컴포넌트에 상태를 등록하여 전역 상태로 관리해주기로 결정</strong>하였다.</p>
<h2 id="전역-상태로-하위-컴포넌트-상태-관리"><a href="#전역-상태로-하위-컴포넌트-상태-관리" class="headerlink" title="전역 상태로 하위 컴포넌트 상태 관리"></a>전역 상태로 하위 컴포넌트 상태 관리</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> openCard = [];</span><br><span class="line"><span class="keyword">let</span> matchedCard = [];</span><br><span class="line"><span class="keyword">let</span> isStarted = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> convertedTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MatchingCards</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">addEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">createEvent</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        <span class="attr">selector</span>: <span class="string">&quot;.start-button&quot;</span>,</span><br><span class="line">        <span class="attr">handler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">start</span>();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">createEvent</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        <span class="attr">selector</span>: <span class="string">&quot;.card-front&quot;</span>,</span><br><span class="line">        <span class="attr">handler</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (openCard.<span class="property">length</span> === <span class="number">2</span> || !isStarted) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">checkCard</span>(+e.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">&quot;.cards&quot;</span>).<span class="property">dataset</span>.<span class="property">id</span>);</span><br><span class="line">          <span class="keyword">if</span> (openCard.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">shuffledNum</span>[openCard[<span class="number">0</span>] - <span class="number">1</span>] ===</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">shuffledNum</span>[openCard[<span class="number">1</span>] - <span class="number">1</span>]</span><br><span class="line">            ) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HOLYMOLY&quot;</span>);</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">matchCard</span>(openCard);</span><br><span class="line">              matchedCard = [...matchedCard, ...openCard];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">resetOpenedCard</span>();</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">createEvent</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        <span class="attr">selector</span>: <span class="string">&quot;.reset-button&quot;</span>,</span><br><span class="line">        <span class="attr">handler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          openCard = [];</span><br><span class="line">          matchedCard = [];</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">resetGame</span>();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">domStr</span>(<span class="params"></span>) &#123;</span><br><span class="line">    openCard = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">openCard</span>;</span><br><span class="line">    isStarted = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">isStarted</span>;</span><br><span class="line">    convertedTime = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">convertedTime</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h1 class=&quot;game-title&quot;&gt;MATCHING CARDS&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;card-container&quot;&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;<span class="variable language_">this</span>.props.shuffledNum</span></span></span><br><span class="line"><span class="subst"><span class="string">          .map(</span></span></span><br><span class="line"><span class="subst"><span class="string">            (num, index) =&gt; <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">          &lt;div class=&quot;cards <span class="subst">$&#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">            openCard.includes(index + <span class="number">1</span>) || matchedCard.includes(index + <span class="number">1</span>)</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">              ? <span class="string">&quot;opened&quot;</span></span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">              : <span class="string">&quot;&quot;</span></span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">          &#125;</span>&quot; data-id=&quot;<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">            &lt;div class=&quot;card-inner&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">              &lt;div class=&quot;card-front&quot;&gt;?&lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">              &lt;div class=&quot;card-back&quot;&gt;<span class="subst">$&#123;num&#125;</span>&lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">            &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">          &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">          `</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          )</span></span></span><br><span class="line"><span class="subst"><span class="string">          .join(<span class="string">&quot;&quot;</span>)&#125;</span></span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;p class=&quot;result-message <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        matchedCard.length === <span class="number">18</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;hidden&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>&quot;&gt;Congratulations!&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;p class=&quot;display&quot;&gt;<span class="subst">$&#123;convertedTime&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;active-button-container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;button class=&quot;start-button&quot;&gt;Start&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;button class=&quot;reset-button&quot;&gt;RESET&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>전역 상태를 domStr()을 호출할 때 지역 변수에 할당하여 지역 변수를 가지고 이벤트 핸들러 내부에서 로직을 구현하였다.</p>
</li>
<li><p>이로 인한 문제점이 게임의 진행을 위해서는 렌더링을 해주기 위해서는 전역 상태를 setState로 변경해줘야 하고 지역 변수를 변경도 이벤트 핸들러 내부에서 따로 해줘야 하므로 같은 로직을 구현하는 상태를 2번 관리해줘야 하는 불편함이 생겼다.</p>
</li>
<li><p>이는 다음주에 리팩토링이 필요할 것으로 보인다.</p>
</li>
</ul>
<h1 id="2-로그인-기능-및-서버-구현"><a href="#2-로그인-기능-및-서버-구현" class="headerlink" title="2. 로그인 기능 및 서버 구현"></a>2. 로그인 기능 및 서버 구현</h1><h2 id="클라이언트-사이드"><a href="#클라이언트-사이드" class="headerlink" title="클라이언트 사이드"></a>클라이언트 사이드</h2><p>먼저 클라이언트는 로그인 페이지에서 input 값으로 요청을 보낸다. 이 때, 서버에 대한 요청을 <code>e.preventDefault()</code>로 막아주고 payload에다가 input 값을 담아서 axios로 post 요청을 보내주었다.(서버의 응답이 도착할 때 까지 await해주었다.)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Signin.js</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">createEvent</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;submit&#x27;</span>,</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;.signin_info&#x27;</span>,</span><br><span class="line">  <span class="attr">handler</span>: <span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> payload = [...<span class="keyword">new</span> <span class="title class_">FormData</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.signin_info&#x27;</span>))].<span class="title function_">reduce</span>(</span><br><span class="line">      <span class="function">(<span class="params">obj, [key, value]</span>) =&gt;</span> ((obj[key] = value), obj),</span><br><span class="line">      &#123;&#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: user &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/signin&#x27;</span>, payload);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;😀 LOGIN SUCCESS!&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (user) <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">navigate</span>(<span class="string">&#x27;/&#x27;</span>, user);</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;user&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;😱 LOGIN FAILURE..&#x27;</span>);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.error&#x27;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// App.js</span></span><br><span class="line"><span class="title function_">navigate</span>(<span class="params">path, user = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span> === path) <span class="keyword">return</span>;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">history</span>.<span class="title function_">pushState</span>(<span class="literal">null</span>, <span class="literal">null</span>, path);</span><br><span class="line">  <span class="keyword">if</span> (user) <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; path, user &#125;);</span><br><span class="line">  <span class="keyword">else</span> <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; path &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>서버에서 응답이 오면 navigate 함수에 메인페이지의 path와 응답으로 받은 데이터를 인자로 넘겨주었다. navigate 함수에서는 user가 있으면 user 상태를 변경하여 렌더링을 해주고 user가 없으면 path에 따라서만 라우터 변경과 렌더링을 해준다.</p>
<h2 id="서버-사이드"><a href="#서버-사이드" class="headerlink" title="서버 사이드"></a>서버 사이드</h2><p>서버에서는 해당 url로 post 요청이 왔을 때, 서버의 데이터에 해당 유저의 id, password를 비교하여 존재하는 유저인지 확인하여 JWT 토큰을 발행하여 쿠키에 담고 이 쿠키와 함께 유저의 닉네임을 응답으로 전달해주었다.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/signin&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; userid, password &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="comment">// userid 가 없거나, password가 없으면 띄워주는 에러메세지</span></span><br><span class="line">  <span class="keyword">if</span> (!userid || !password)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">      .<span class="title function_">status</span>(<span class="number">401</span>)</span><br><span class="line">      .<span class="title function_">send</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;사용자 아이디 또는 패스워드가 전달되지 않았습니다.&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// users배열에 userid와 password가 일치하는 user있는지 find 해서 user에 담아준다.</span></span><br><span class="line">  <span class="keyword">const</span> user = users.<span class="title function_">find</span>(</span><br><span class="line">    <span class="function">(<span class="params">user</span>) =&gt;</span> user.<span class="property">userid</span> === userid &amp;&amp; user.<span class="property">password</span> === password</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 만약 위 검색에서 user가 담기지 않았다면 띄워주는 에러메세지</span></span><br><span class="line">  <span class="keyword">if</span> (!user)</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;등록되지 않은 사용자입니다.&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 로그인 성공 시 user 가 있다면 jwt 토큰을 발급해서 response의 헤더에 쿠키에 담아서 보내줘야함.</span></span><br><span class="line">  <span class="keyword">const</span> accessToken = jwt.<span class="title function_">sign</span>(&#123; userid &#125;, process.<span class="property">env</span>.<span class="property">JWT_SECRET_KEY</span>, &#123;</span><br><span class="line">    <span class="attr">expiresIn</span>: <span class="string">&quot;1d&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&quot;accessToken&quot;</span>, accessToken, &#123;</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>, <span class="comment">// 7d</span></span><br><span class="line">    <span class="attr">httpOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(user.<span class="property">nickname</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="JWT-JSON-Web-Token-이란"><a href="#JWT-JSON-Web-Token-이란" class="headerlink" title="JWT(JSON Web Token)이란?"></a>JWT(JSON Web Token)이란?</h3><p>Access token을 이용한 서버 인증 방식 중 하나이다.</p>
<p>서버에 로그인 요청이 오면 사용자를 확인한 다음 JWT을 발행한다. 생성한 토큰을 클라이언트에게 쿠키를 통해 전달해주고 클라이언트는 쿠키에 이 토큰을 저장한다.</p>
<blockquote>
<p>토큰은 암호화되어있고 클라이언트에서는 암호화를 해석한 코드를 가지게 하면 안되며 암호를 해석하는 일은 서버에서만 해야한다.</p>
</blockquote>
<p>이제 토큰이 있는 사용자는 권한이 필요한 요청을 할 때마다 토큰을 header에 실어 서버에 보낸다.</p>
<p>서버는 토큰을 해석하여 로그인한 사용자인지를 판단하여 성공 및 실패 응답을 보내준다.</p>
<h3 id="env-이란"><a href="#env-이란" class="headerlink" title=".env 이란?"></a>.env 이란?</h3><p>.env 파일에는 개발을 하면서 중요한 정보들 특히, DB 관련 정보와 API_KEY 등의 정보를 보관하는 용도의 파일이다.</p>
<p>이러한 파일들은 git에 올리면 안되므로 gitignore를 해줘야한다.</p>
<ul>
<li>사용방법</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install dotenv  //다운로드</span><br><span class="line"></span><br><span class="line">require(&quot;dotenv&quot;).config(); //js 파일 상단에 적어주기</span><br></pre></td></tr></table></figure>

<ul>
<li>.env 파일은 최상위 루트에 생성해야한다.</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .env</span></span><br><span class="line"><span class="variable constant_">PORT</span> = <span class="number">5010</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> port = process.<span class="property">env</span>.<span class="property">PORT</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>이러한 방식으로 사용한다.</li>
</ul>
<h1 id="3-로그인한-유저에게-인가"><a href="#3-로그인한-유저에게-인가" class="headerlink" title="3. 로그인한 유저에게 인가"></a>3. 로그인한 유저에게 인가</h1><p>로그인한 유저는 JWT를 쿠키에 가지고 있으므로 권한이 필요한 요청을 할 때, 즉 로그인한 사용자만 접근 가능한 페이지에 접근 요청을 서버에 보내면 서버는 JWT를 해석하여 로그인한 사용자인지 아닌지를 판단하여 그에 알맞은 응답을 보낸다.</p>
<p>그에 대한 로직은 다음과 같다.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">auth</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 토큰이 리퀘스트의 Authorization 헤더를 통해 전달되면 req.headers.authorization으로 전달받고</span></span><br><span class="line"><span class="comment">     * 토큰이 쿠키를 통해 전달되면 req.cookies.accessToken으로 전달받는다.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> accessToken = req.<span class="property">headers</span>.<span class="property">authorization</span> || req.<span class="property">cookies</span>.<span class="property">accessToken</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(accessToken, process.<span class="property">env</span>.<span class="property">JWT_SECRET_KEY</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`😀 사용자 인증 성공`</span>, decoded);</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;😱 사용자 인증 실패..&#x27;</span>, e);</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;등록되지 않은 사용자입니다.&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/rank&#x27;</span>, auth, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;로그인된 사용자입니다.&#x27;</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>&#x2F;rank url로 요청이 오면 auth 함수를 실행한다.</p>
</li>
<li><p>auth 함수에서는 요청의 header나 쿠키에 권한이나 access token이 있는지를 확인하여 이를 해석하고 로그인 성공 실패 유무를 판단하여 응답을 보내준다.</p>
</li>
</ul>
<h1 id="소감"><a href="#소감" class="headerlink" title="소감"></a>소감</h1><p>프로젝트를 시작하기 전에 기술적인 기획이 매우 중요하다는 것을 깨닫게 되었다. 하위 컴포넌트에서 지역 상태를 관리할 수 없을 것이라는 것을 구조를 보고 알 수 있었더라면, 그에 따라 구조를 개선한 후 프로젝트에 임할 수 있었을 텐데 중간에 큰 문제에 봉착하게 되니 머리가 텅 비워지는 상황을 경험하였다. 결국 시간을 고려하여 회피를 하게되는 문제점이 발생하게 되었다.</p>
<p>팀원 중 한명이 몸이 안좋아 2명이서 프로젝트를 진행하게 되었다. 3명이서 같이 나눠서 공부하고 공유하면 더욱 좋았을텐데 이점은 조금 아쉽다. 건강상의 이유로 참여하지 못한 팀원도 안쓰러웠다. 다음주에 쾌유해서 돌아오면 그동안 공부했던 것을 공유해주면서 배웠던 지식을 다시 정리해봐야겠다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/JWT/" rel="tag">JWT</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/env/" rel="tag">env</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/17/Project/holymoly/%EB%9D%BC%EC%9A%B0%ED%84%B0%20%ED%95%A8%EC%88%98%EC%99%80%20pushState,%20%EB%9E%AD%EC%BB%A4%20%EB%B3%B4%EC%97%AC%EC%A3%BC%EA%B8%B0/"
                    data-tooltip="라우터 함수와 pushState, 랭커 보여주기"
                    aria-label="이전: 라우터 함수와 pushState, 랭커 보여주기"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/13/Project/holymoly/CBD%20%EA%B8%B0%EB%B0%98%20%EB%9D%BC%EC%9A%B0%ED%84%B0%20%EA%B5%AC%ED%98%84/"
                    data-tooltip="CBD 기반 라우터 구현"
                    aria-label="다음: CBD 기반 라우터 구현"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2023 loco9939. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/17/Project/holymoly/%EB%9D%BC%EC%9A%B0%ED%84%B0%20%ED%95%A8%EC%88%98%EC%99%80%20pushState,%20%EB%9E%AD%EC%BB%A4%20%EB%B3%B4%EC%97%AC%EC%A3%BC%EA%B8%B0/"
                    data-tooltip="라우터 함수와 pushState, 랭커 보여주기"
                    aria-label="이전: 라우터 함수와 pushState, 랭커 보여주기"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/13/Project/holymoly/CBD%20%EA%B8%B0%EB%B0%98%20%EB%9D%BC%EC%9A%B0%ED%84%B0%20%EA%B5%AC%ED%98%84/"
                    data-tooltip="CBD 기반 라우터 구현"
                    aria-label="다음: CBD 기반 라우터 구현"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://loco9939.github.io/2022/10/14/Project/holymoly/CBD%20%EA%B5%AC%EC%A1%B0%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D%20%EB%AC%B8%EC%A0%9C,%20JWT,%20.env/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">loco9939</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-wcqoifde3xwnijjx9xd2irfrrksglozwqpgaqfvxoft22e4znrk7db1xxnsx.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
